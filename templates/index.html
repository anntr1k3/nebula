{% extends "base.html" %}

{% block content %}
<div id="app" id="main-content">
  <div id="sidebar">
    <div id="user-info">
      <div class="username">{{ current_user.avatar }} {{ current_user.username }}</div>
      <div class="user-settings">
        <a href="{{ url_for('profile_page') }}" class="settings-btn" aria-label="{{ translations.edit_profile }}">
          <span>‚öôÔ∏è</span>
          <span data-i18n="profile">{{ translations.profile }}</span>
        </a>
        <button id="language-btn" class="settings-btn" aria-label="{{ translations.change_language }}">
          <span>üåê</span>
          <span class="lang-text">{{ 'EN' if user_lang == 'ru' else 'RU' }}</span>
        </button>
        <button id="theme-toggle" aria-label="{{ translations.change_theme }}">
          <span class="theme-icon">üåô</span>
          <span class="theme-text" data-i18n="change_theme">{{ translations.change_theme }}</span>
        </button>
        <button id="logout-btn" onclick="location.href='{{ url_for('logout') }}'" aria-label="{{ translations.logout }}" data-i18n="logout">{{ translations.logout }}</button>
      </div>
    </div>
    
    <div id="actions">
      <a href="{{ url_for('create_chat_page') }}" class="action-btn" aria-label="{{ translations.find_users }}">
        <span>üîç</span>
        <span data-i18n="find_users">{{ translations.find_users }}</span>
      </a>
      <a href="{{ url_for('create_group_page') }}" class="action-btn" aria-label="{{ translations.create_group }}">
        <span>‚ûï</span>
        <span data-i18n="create_group">{{ translations.create_group }}</span>
      </a>
    </div>
    
    <h2 data-i18n="rooms">{{ translations.rooms }}</h2>
    <ul id="rooms-list">
      {% for room in rooms %}
        <li data-room-id="{{ room.id }}" data-is-group="{{ 'true' if room.is_group else 'false' }}" data-is-private="{{ 'true' if room.is_private else 'false' }}">
          {% if room.is_private %}üí¨{% elif room.is_group %}üë•{% else %}#{% endif %} {{ room.name }}
        </li>
      {% endfor %}
    </ul>
  </div>

  <div id="chat-container">
    <div id="chat-header">
      <div id="room-title"></div>
      <div id="room-actions">
        <button id="invite-btn" style="display: none;">
          <span>‚ûï</span>
          <span data-i18n="invite">{{ translations.invite }}</span>
        </button>
        <button id="members-btn" style="display: none;">
          <span>üë•</span>
          <span data-i18n="members">{{ translations.members }}</span>
        </button>
      </div>
    </div>
    
    <div id="connection-status"></div>
    
    <div id="messages"></div>
    
    <div id="typing-indicator"></div>
    
    <div id="input-area">
      <input 
        type="text" 
        id="message-input" 
        placeholder="{{ translations.type_message }}"
        data-i18n="type_message"
        maxlength="500"
        autocomplete="off"
        aria-label="{{ translations.type_message }}"
      />
      <span id="char-count">0/500</span>
      <button id="send-button" disabled aria-label="{{ translations.send }}" data-i18n="send">{{ translations.send }}</button>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É -->
<div id="invite-modal" class="modal" role="dialog" aria-labelledby="invite-modal-title" aria-hidden="true">
  <div class="modal-content" role="document">
    <button class="close" aria-label="{{ translations.close }}">&times;</button>
    <h2 id="invite-modal-title" data-i18n="invite_to_group">{{ translations.invite_to_group }}</h2>
    <input type="text" id="invite-search-input" placeholder="{{ translations.search_placeholder }}" data-i18n="search_placeholder" autocomplete="off" aria-label="{{ translations.search_users }}" />
    <div id="invite-search-results"></div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
<div id="members-modal" class="modal" role="dialog" aria-labelledby="members-modal-title" aria-hidden="true">
  <div class="modal-content" role="document">
    <button class="close" aria-label="{{ translations.close }}">&times;</button>
    <h2 id="members-modal-title" data-i18n="members_list">{{ translations.members_list }}</h2>
    <div id="members-list"></div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<script>
  // –ü–µ—Ä–µ–¥–∞–µ–º —è–∑—ã–∫ –≤ JavaScript
  document.body.dataset.lang = '{{ user_lang }}';
  {% if selected_room_id %}
  // –ü–µ—Ä–µ–¥–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–Ω–∞—Ç—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
  window.selectedRoomId = {{ selected_room_id }};
  {% endif %}
</script>
<script src="{{ url_for('static', filename='js/animations.js') }}"></script>
<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script src="{{ url_for('static', filename='js/language-toggle.js') }}"></script>
{% endblock %}
